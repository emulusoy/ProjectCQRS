@model List<GasPriceVM>
@using System.Globalization
@{
    ViewData["Title"] = "Dashboard";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
    var tr = CultureInfo.GetCultureInfo("tr-TR");
    dynamic stats = ViewBag.Stats ?? new { CarCount = 0, ActiveReservations = 0, AvgRating = 0.0 };
    dynamic me = ViewBag.Me ?? new { Name = "Admin", Role = "Yönetici", Email = "admin@example.com" };
    var reviews = (IEnumerable<dynamic>)(ViewBag.Reviews ?? new List<dynamic>());
    var topCars = (IEnumerable<dynamic>)(ViewBag.TopCars ?? new List<dynamic>());
}

<style>
    /* ---- Genel ---- */
    .dash-title {
        font-weight: 700;
        letter-spacing: .2px;
    }

    .soft-card {
        border: 1px solid #e9ecef;
        border-radius: 14px;
        box-shadow: 0 4px 10px rgba(0,0,0,.04);
    }

        .soft-card .card-header {
            background: #fff;
            border-bottom: 1px solid #f1f3f5;
        }

    /* ---- Özet kutuları ---- */
    .mini-stat {
        border-radius: 12px;
        padding: 16px;
        border: 1px solid #edf2f7;
        background: #fff;
    }

        .mini-stat .icon {
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
        }

        .mini-stat .value {
            font-size: 1.25rem;
            font-weight: 700;
        }

        .mini-stat .label {
            color: #6c757d;
            font-size: .9rem;
        }

    /* ---- Gas price kartları ---- */
    .price-card {
        border: 1px solid #eaecef;
        border-radius: 12px;
        transition: transform .15s ease, box-shadow .15s ease;
    }

        .price-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(0,0,0,.06);
        }

    .price-badge {
        font-weight: 700;
    }

    .gasoline-color {
        color: #f25f4c;
    }

    .diesel-color {
        color: #43aa8b;
    }

    .lpg-color {
        color: #5c677d;
    }

    .card-title-country {
        font-weight: 700;
        color: #2b2f33;
    }

    /* ---- Yorumlar ---- */
    .review-item .user {
        font-weight: 600;
    }

    .review-item .car {
        color: #6c757d;
    }

    .star {
        color: #f4c430;
    }

        .star.off {
            color: #d9dee3;
        }

    /* ---- Araç kartları ---- */
    .car-card {
        border: 0;
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 10px 24px rgba(0,0,0,.06);
    }

        .car-card .img-wrap {
            aspect-ratio: 16/9;
            overflow: hidden;
            background: #f8f9fa;
        }

        .car-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform .3s ease;
        }

        .car-card:hover img {
            transform: scale(1.03);
        }

    .car-badges .badge {
        font-weight: 600;
    }
</style>

<div class="container-fluid py-4">

    <!-- Sayfa başlığı & Hakkımda & Mini istatistikler -->
    <div class="row g-3 align-items-stretch mb-4">
        <div class="col-md-8">
            <div class="mini-stat h-100 d-flex align-items-center justify-content-between">
                <div>
                    <div class="text-muted mb-1">Hoş geldin,</div>
                    <h3 class="dash-title mb-0">@me.Name</h3>
                    <div class="small text-muted">@me.Role • @me.Email</div>
                </div>
                <div class="d-none d-md-flex gap-2">
                    <div class="mini-stat text-center">
                        <div class="icon bg-light"><i class="fas fa-car text-primary"></i></div>
                        <div class="value mt-2">@stats.CarCount</div>
                        <div class="label">Toplam Araç</div>
                    </div>
                    <div class="mini-stat text-center">
                        <div class="icon bg-light"><i class="fas fa-receipt text-success"></i></div>
                        <div class="value mt-2">@stats.ActiveReservations</div>
                        <div class="label">Aktif Rezervasyon</div>
                    </div>
                    <div class="mini-stat text-center">
                        <div class="icon bg-light"><i class="fas fa-star text-warning"></i></div>
                        <div class="value mt-2">@String.Format(tr, "{0:0.0}", stats.AvgRating)</div>
                        <div class="label">Ortalama Puan</div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Hakkımda kartı -->
        <div class="col-md-4">
            <div class="soft-card h-100">
                <div class="card-header d-flex align-items-center justify-content-between">
                    <strong>Hakkımda</strong>
                    <i class="fas fa-user-circle text-secondary"></i>
                </div>
                <div class="card-body">
                    <p class="mb-2"><i class="fas fa-building me-2 text-primary"></i>EMU Rent A Car</p>
                    <p class="mb-2"><i class="fas fa-envelope me-2 text-primary"></i>@me.Email</p>
                    <p class="mb-0"><i class="fas fa-info-circle me-2 text-primary"></i>Panel kısa özeti ve son durum.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 1) Avrupa Yakıt Fiyatları -->
    <div class="soft-card mb-4">
        <div class="card-header d-flex align-items-center justify-content-between">
            <h5 class="mb-0">Avrupa Yakıt Fiyatları</h5>
            <small class="text-muted">Güncel liste</small>
        </div>
        <div class="card-body">
            <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-3">
                @if (Model != null && Model.Any())
                {
                    foreach (var item in Model)
                    {
                        <div class="col">
                            <div class="card price-card h-100">
                                <div class="card-body">
                                    <div class="d-flex align-items-center mb-2">
                                        <i class="fas fa-map-marker-alt me-2 text-primary"></i>
                                        <h6 class="card-title-country mb-0">@item.country</h6>
                                    </div>
                                    <hr class="my-2" />
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <span class="d-flex align-items-center">
                                            <i class="fas fa-gas-pump me-2 gasoline-color"></i>
                                            <strong>Benzin</strong>
                                        </span>
                                        <span class="price-badge gasoline-color">@item.gasoline @item.currency</span>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <span class="d-flex align-items-center">
                                            <i class="fas fa-oil-can me-2 diesel-color"></i>
                                            <strong>Dizel</strong>
                                        </span>
                                        <span class="price-badge diesel-color">@item.diesel @item.currency</span>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span class="d-flex align-items-center">
                                            <i class="fas fa-tint me-2 lpg-color"></i>
                                            <strong>LPG</strong>
                                        </span>
                                        <span class="price-badge lpg-color">@item.lpg @item.currency</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                }
                else
                {
                    <div class="col">
                        <div class="alert alert-warning mb-0">Yakıt fiyatı verileri bulunamadı.</div>
                    </div>
                }
            </div>
        </div>
    </div>

    <!-- 2) Son Yorumlar -->
    <div class="soft-card mb-4">
        <div class="card-header d-flex align-items-center justify-content-between">
            <h5 class="mb-0">Son Yorumlar</h5>
            <a href="/Admin/ContactList" class="btn btn-sm btn-outline-primary"><i class="fas fa-list me-1"></i>Tümünü Gör</a>
        </div>
        <div class="card-body">
            @if (!reviews.Any())
            {
                <div class="text-muted">Henüz yorum yok.</div>
            }
            else
            {
                <div class="list-group list-group-flush">
                    @foreach (var r in reviews)
                    {
                        int pt = Math.Min(5, Math.Max(0, (int)(r.Point ?? 0)));
                        <div class="list-group-item review-item">
                            <div class="d-flex align-items-center justify-content-between">
                                <div>
                                    <span class="user">@r.User</span>
                                    <span class="car ms-2">— @r.Car</span>
                                </div>
                                <div class="small text-muted">
                                    @(((DateTime?)r.Date)?.ToString("dd.MM.yyyy HH:mm") ?? "")
                                </div>
                            </div>
                            <div class="my-1">
                                @for (int i = 1; i <= 5; i++)
                                {
                                    <i class="fa-star @(i <= pt ? "fas star" : "far star off")"></i>
                                }
                            </div>
                            <div>@(r.Comment ?? "")</div>
                        </div>
                    }
                </div>
            }
        </div>
    </div>

    <!-- 3) Öne Çıkan Araçlar (büyük görselli kartlar) -->
    <div class="soft-card">
        <div class="card-header d-flex align-items-center justify-content-between">
            <h5 class="mb-0">Öne Çıkan Araçlar</h5>
            <a href="/Car/Index" class="btn btn-sm btn-outline-secondary">Tüm Araçlar</a>
        </div>
        <div class="card-body">
            @if (!topCars.Any())
            {
                <div class="text-muted">Listelenecek araç bulunamadı.</div>
            }
            else
            {
                <div class="row g-4">
                    @foreach (var c in topCars.Take(4))
                    {
                        <div class="col-12 col-md-6 col-xl-3">
                            <div class="card car-card h-100">
                                <div class="img-wrap">
                                    <img src="@(c.ImageUrl ?? "/cqrsrent/img/car-1.jpg")" alt="@c.Name" loading="lazy">
                                </div>
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <h6 class="mb-1">@c.Name</h6>
                                        <div class="text-warning">
                                            @{
                                                double rate = (double)(c.Rating ?? 0.0);
                                                int full = (int)Math.Round(Math.Min(5, Math.Max(0, rate)));
                                                for (int i = 1; i <= 5; i++)
                                                {
                                                    @:<i class="fa-star @(i <= full ? "fas" : "far text-muted")"></i>
                                                }
                                            }
                                        </div>
                                    </div>
                                    <div class="text-primary fw-bold mb-2">
                                        @( ((decimal?)c.PricePerDay ?? 0m).ToString("N2", tr) ) TL / gün
                                    </div>
                                    <div class="car-badges d-flex flex-wrap gap-2 mb-2">
                                        <span class="badge bg-light text-dark"><i class="fas fa-industry me-1"></i>@(c.Brand ?? "")</span>
                                        <span class="badge bg-light text-dark"><i class="fas fa-cogs me-1"></i>@(c.Transmission ?? "")</span>
                                        <span class="badge bg-light text-dark"><i class="fas fa-gas-pump me-1"></i>@(c.Fuel ?? "")</span>
                                        <span class="badge bg-light text-dark"><i class="fas fa-users me-1"></i>@(c.Seat ?? "")</span>
                                    </div>
                                    <div class="text-muted small mb-3">
                                        <i class="fas fa-calendar-alt me-1"></i>@(c.ModelYear ?? "-")
                                        &nbsp;•&nbsp;
                                        <i class="fas fa-road me-1"></i>@String.Format(tr, "{0:N0} km", (int?)c.Km ?? 0)
                                    </div>
                                    <a href="/Car/Index" class="btn btn-outline-primary w-100">
                                        <i class="fas fa-search me-1"></i> Detaya Git
                                    </a>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            }
        </div>
    </div>

</div>
